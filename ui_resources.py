ST_STYLE = """
<style>
    /* Professional Dark Theme */
    .stApp {
        background-color: #0E1117;
        color: #FAFAFA;
    }
    /* Metric Cards */
    div[data-testid="stMetric"] {
        background-color: #262730;
        border: 1px solid #464B5C;
        padding: 15px;
        border-radius: 5px;
    }
    /* Tabs */
    .stTabs [data-baseweb="tab-list"] {
        gap: 24px;
    }
    .stTabs [data-baseweb="tab"] {
        height: 50px;
        white-space: pre-wrap;
        background-color: transparent;
        border-radius: 4px 4px 0px 0px;
        color: #FAFAFA;
        font-weight: 600;
    }
    div[data-testid="stExpander"] {
        background-color: #1E1E1E;
        border: 1px solid #464B5C;
        border-radius: 5px;
    }
</style>
"""

AI_MODEL_EXPLANATION = """
### 🧠 AI 模型運算邏輯解密

本平台採用兩種截然不同的先進演算法進行「混合專家 (Mixture of Experts)」預測，讓您能同時參考機器學習與深度學習的觀點。

#### 1. XGBoost (極端梯度提升樹) - 機器學習專家 🤖
*   **核心概念**: 它是「決策樹 (Decision Tree)」的集大成者。想像有 100 位分析師，每位都只懂一點點股票規則（例如：RSI > 70 就賣），XGBoost 會將這 100 位的意見加權整合，修正彼此的錯誤，形成強大的預測力。
*   **運算特徵**: 
    *   專注於 **「當下狀態」** 與 **「技術指標」** 之間的關係。
    *   輸入特徵包含：移動平均線 (MA5, MA20)、RSI 相對強弱指標、乖離率 (PctChange)、成交量變化 (VolChange)、恐慌指數 (VIX)。
*   **強項**: 對於突發性的漲跌、明確的技術訊號反應極快，且不易過度擬合 (Overfitting)。

#### 2. LSTM (長短期記憶神經網路) - 深度學習大腦 🧠
*   **核心概念**: 這是一種模仿真人記憶機制的類神經網路。一般的模型只看「今天」，但 LSTM 擁有「記憶單元」，能記住過去 60 天的股價走勢圖形 (Pattern)。它不只看數字，更是在看「趨勢的慣性」。
*   **運算特徵**:
    *   **遞迴預測 (Recursive Prediction)**: 在預測未來 5 天時，它會將「T+1 的預測值」當作已知事實，重新餵入模型去推算 T+2，以此類推。這模擬了人類推演未來的情境。
    *   **全歷史學習**: 模型在最終預測前，會重新掃描過去 2 年每一天的歷史軌跡，確保掌握最新的市場節奏。
*   **強項**: 擅長捕捉時間序列中的「週期性」與「長期趨勢」，對於連續上漲或下跌的慣性捕捉能力極強。

#### 3. Prophet (先知模型) - 週期循環大師 🔮
*   **核心概念**: 由 Meta (Facebook) 開發，專門用來處理具有「季節性」的數據。它不看 RSI 或均線，而是將股價拆解成：**長期趨勢** + **季節性循環 (週/年)** + **假日效應**。
*   **運算特徵**:
    *   **季節拆解**: 它能算出這檔股票是否「每逢週五容易跌？」或「每年 10 月容易漲？」。
    *   **穩健趨勢**: 它的預測線通常較為平滑，不易受單日暴漲暴跌影響，代表的是一種「應有的合理價值」。
*   **強項**: 對於中長期的「規律性」捕捉非常精準，適合用來觀察「大方向」與「季節效應」。

#### ⚖️ 三大模型如何共用？
*   **短線爆發**: 看 **XGBoost** (技術指標最敏感)。
*   **波段趨勢**: 看 **LSTM** (慣性與記憶)。
*   **中長佈局**: 看 **Prophet** (季節性與合理價值)。
*   **共識決**: 若三者方向一致，即為**強力訊號**。
"""

MANUAL_TEXT = """
# 📘 平台使用指南 (User Manual)

歡迎使用 **台股智投旗艦版**！本平台專為台股投資人設計，結合即時行情、技術分析與智能自動交易功能。

---

## 🚀 快速入門

1.  **自選股管理**:
    *   從左側欄「⚙️ 管理與新增」分頁，輸入代碼 (如 2330) 或從熱門清單選擇，建立您的觀察名單。
    *   支援多組清單 (如: "半導體", "高股息ETF")，可隨時切換。

2.  **個股分析**:
    *   查看 K 線圖、均線 (MA5, MA20) 與 MACD 指標。
    *   右側「⚡ 快速下單」面板可直接進行模擬交易 (現股/融券)。

3.  **投資組合**:
    *   查看目前的持倉部位、成本與未實現損益。
    *   提供「一鍵重置」功能，將帳戶還原至初始狀態 (1000萬)。

---

## 🤖 智能交易機器人 (Auto-Trading)

這是本平台的核心功能，能協助您 24 小時監控股市並自動執行交易。

### 1. 運作邏輯
*   **買進 (Buy)**: 當策略產生買進訊號 (Signal 1) 且資金充足時，買入設定的張數。
*   **賣出 (Sell)**: 當策略產生賣出訊號 (Signal -1) 時，**全數出清**該股庫存。
*   **風控 (Risk)**: 優先於策略。一旦觸發停損或停利，立即**強制平倉**。

### 2. 設定步驟
1.  **新增監控**: 在機器人頁面，從自選股中勾選要監控的股票，並設定「每次買進張數」。
2.  **設定參數**: 調整全域的「停損%」、「停利%」與「單檔資金上限」。
3.  **啟動**: 按下右側的「▶️ 啟動」按鈕。

### 3. 策略與最佳化
點擊「🚀 執行策略最佳化」，系統會針對每一檔監控中的股票，進行過去 1 年的回測，自動從以下策略中挑選最賺錢的一個：
*   **MA Cross**: 均線黃金/死亡交叉。
*   **RSI**: 超賣(<30)買進、超買(>70)賣出。
*   **MACD**: 柱狀圖趨勢反轉。
*   **KD**: KD 指標黃金/死亡交叉。

---

## 🔬 策略回測實驗室

不確定策略好不好？先測再說！
*   選擇標的與策略，設定回測期間 (預設 2 年)。
*   系統將計算 **總報酬率 (Total Return)**、**勝率 (Win Rate)** 與 **最大回撤 (MDD)**。
*   下方提供詳細的逐筆交易紀錄。

---

## ❓ 常見問題 (FAQ)

**Q: 關閉瀏覽器後，機器人還會跑嗎？**
A: **不會**。本平台依賴瀏覽器頁面運作 (Streamlit 機制)。請保持分頁開啟以維持自動交易。

**Q: 資料會不見嗎？**
A: 資料會儲存在您的專屬雲端設定檔中。只要使用相同帳號登入，設定都在。

**Q: 模擬資金用完了怎麼辦？**
A: 到「投資組合總覽」頁面最下方，點擊「確認清空資產」即可重置為 1000 萬。
"""
